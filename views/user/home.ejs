<%- include('../partials/header') %>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="/css/user/home.css">

    <body>

         <%- include('../partials/navbar') %>

        <section class="hero">
            <div class="container hero-content">
                <div class="hero-text">
                    <span class="tagline">New Arrivals</span>
                    <h1>Discover the Future of Performance</h1>
                    <p>Premium laptops with cutting-edge technology and unbeatable battery life.</p>
                    <a href="/user/login" class="btn-shop-now">
                        Shop Now <i class='bx bx-right-arrow-alt'></i>
                    </a>
                </div>
                <div class="hero-image">
                    <img src="/images/banner-img.png" alt="Hero Laptop">
                </div>
            </div>
        </section>

        <nav class="category-nav">
            <div class="container">
                <div class="category-list">

                    <a href="/" class="cat-item <%= typeof selectedCat === 'undefined' ? 'active' : '' %>">All</a>

                    <% if(categories && categories.length> 0) { %>
                        <% categories.forEach(cat=> { %>

                            <a href="/user/category/<%= cat.slug %>"
                                class="cat-item <%= (typeof selectedCat !== 'undefined' && selectedCat.toString() === cat.slug.toString()) ? 'active' : '' %>">
                                <%= cat.categoryName %>
                            </a>

                            <% }) %>
                                <% } %>
                </div>

            </div>
        </nav>

        <main class="container main-content" id="products">
            <div class="filter-bar">
                <h2>Featured Laptops</h2>
                <div class="filter-actions">
                    <div class="dropdown">
                        <label for="brandFilter">Brand:</label>
                        <select id="brandFilter">
                            <option value="" <%=typeof currentBrand==='undefined' ? 'selected' : '' %>>All Brands
                            </option>
                            <% if(typeof brands !==undefined && brands.length> 0){ %>
                                <% brands.forEach(brand=> { %>
                                    <option value="<%= brand.brandName %>" <%=typeof currentBrand !=='undefined' &&
                                        currentBrand===brand.brandName ? 'selected' : '' %>>
                                        <%= brand.brandName %>
                                    </option>
                                    <% }) %>
                                        <% } %>
                        </select>
                    </div>
                </div>
                <div class="filter-actions">
                    <div class="dropdown">
                        <label for="sort">Sort by:</label>
                        <select id="sort">
                            <option value="featured" <%=currentSort==='featured' ? 'selected' : '' %>>Featured</option>
                            <option value="price-low" <%=currentSort==='price-low' ? 'selected' : '' %>>Price: Low to
                                High</option>
                            <option value="price-high" <%=currentSort==='price-high' ? 'selected' : '' %>>Price: High to
                                Low</option>
                        </select>
                    </div>

                </div>
            </div>

            <section class="product-grid">
                <% if(products.length> 0) { %>
                    <% products.forEach(product=> { %>

                        <div class="product-card">
                            <div class="badge">Hot</div>
                            <div class="product-tumb">
                                <% if(product.images && product.images.length> 0) { %>

                                    <img src="<%= product.images[0] %>" alt="<% product.name %>">
                                    <% } %>
                            </div>
                            <div class="product-details">
                                <span class="product-cat">
                                    <%= product.brandDetails.brandName || 'Generic' %>
                                </span>
                                <h4><a href="">
                                        <%= product.name %>
                                    </a></h4>
                                <div class="product-bottom-details">
                                    <div class="product-price">
                                        <% if(product.minPrice) { %>
                                            â‚¹<%= product.minPrice.toLocaleString('en-IN') %>
                                                <% }else { %>
                                                    Unavailable
                                                    <% } %>
                                    </div>
                                    <a href="/user/product/<%= product._id %>" class="btn-view-options">
                                        Get details
                                    </a>
                                </div>
                            </div>
                        </div>
                        <% }) %>
                            <% } %>

            </section>

            <nav class="pagination">
                <% if (typeof totalPages !=='undefined' && totalPages> 1) { %>

                    <% if (currentPage> 1) { %>
                        <a href="#" class="pagination-link prev" data-page="<%= currentPage - 1 %>">
                            <i class='bx bx-chevron-left'></i> Prev
                        </a>
                        <% } %>

                            <% for(let i=1; i <=totalPages; i++) { %>
                                <a href="#" class="pagination-link <%= currentPage === i ? 'active' : '' %>"
                                    data-page="<%= i %>">
                                    <%= i %>
                                </a>
                                <% } %>

                                    <% if (currentPage < totalPages) { %>
                                        <a href="#" class="pagination-link next" data-page="<%= currentPage + 1 %>">
                                            Next <i class='bx bx-chevron-right'></i>
                                        </a>
                                        <% } %>

                                            <% } %>
            </nav>
        </main>
        <script>

            const showToast = (message, type) => {
                const bgColor = type === 'success' ? "#28a745" : "#dc3545";
                Toastify({
                    text: message,
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    style: { background: bgColor, borderRadius: '10px' }
                }).showToast();
            };
            document.addEventListener('DOMContentLoaded', () => {
                const sortDropdown = document.getElementById('sort');
                const brandDropdown = document.getElementById('brandFilter')
                const paginationLinks = document.querySelectorAll('.pagination-link'); // Select all pagination links   


                if (sortDropdown) {
                    sortDropdown.addEventListener('change', (e) => {
                        const selectedValue = e.target.value;
                        let newUrl = window.location.pathname;

                        // 1. Check if the value is 'featured' (default state)
                        if (selectedValue === 'featured') {
                            // Redirect without any query parameters
                            window.location.href = newUrl;
                        } else {
                            // 2. Redirect with the new sort parameter
                            // e.g., /user/home?sort=price-low
                            window.location.href = newUrl + `?sort=${selectedValue}`;
                        }
                    });
                }

                if (brandDropdown) {
                    brandDropdown.addEventListener('change', (e) => {
                        const selectedValue = e.target.value;

                        updateParams('brand', selectedValue);
                    })
                }

                const updateParams = (key, value) => {
                    const currentUrl = new URL(window.location.href);

                    if (value && value !== 'featured') {
                        currentUrl.searchParams.set(key, value)
                    } else {
                        currentUrl.searchParams.delete(key)
                    }

                    window.location.href = currentUrl.toString();
                }

                paginationLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault(); 
                        const page = link.getAttribute('data-page');
                        updateParams('page', page); 
                    });
                });
            });
        </script>

        <%- include('../partials/footer') %>