<%- include('../partials/header') %>
    <link rel="stylesheet" href="/css/user/resetPassword.css">

    <body>

        <header class="header">
            <a href="#" class="logo">
                <span class="logo-icon"></span>
                LapStore
            </a>

            <nav>
                <ul class="nav-links">
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Brands</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </nav>

            <div class="nav-icons">
                <a href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </a>
                <a href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </a>
                <a href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                </a>
            </div>
        </header>

        <main class="main-content">
            <div class="reset-container">
                <h1>Reset your password</h1>
                <p>Enter a new password for your account.</p>

                <form class="reset-form" id="resetForm">
                    <div class="input-group">
                        <input type="password" id="password" name="password" placeholder="New Password" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="confirmPassword" name="confirmPassword"
                            placeholder="Confirm New Password" required>
                    </div>
                    <button type="submit" class="save-button">Save New Password</button>
                </form>
            </div>
        </main>

        <%- include('../partials/footer') %>

            <script src="/js/axios.min.js"></script>


            <script>
                const resetForm = document.getElementById('resetForm');

                // Reusable Toast function
                const showToast = (message, type) => {
                    const bgColor = type === 'success' ? "linear-gradient(to right, #30E527, #238500)" : "linear-gradient(to right, #e52d27, #b31217)";
                    Toastify({
                        text: message,
                        duration: 3000,
                        gravity: "top",
                        position: "right",
                        style: { background: bgColor, borderRadius: '10px' }
                    }).showToast();
                };

                resetForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    // 4. Get Values
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    const btn = document.querySelector('.save-button')

                    Loading.showButton(btn);
                    // Simple Client-side validation
                    if (password !== confirmPassword) {
                        Loading.hideButton(btn)
                        showToast("Passwords do not match", "error");
                        return;
                    }

                    try {
                        // 5. Send Request
                        const response = await axios.post('/user/reset-password', {
                            password: password,
                            confirmPassword: confirmPassword
                        });

                        if (response.data.success) {
                            showToast(response.data.message, 'success');

                            // Redirect to login after success
                            setTimeout(() => {
                                window.location.href = '/user/login';
                            }, 1500);
                        } else {
                            Loading.hideButton(btn)
                            showToast(response.data.message || 'Reset failed', 'error');
                        }

                    } catch (error) {
                        Loading.hideButton(btn)
                        console.error(error);
                        const errMsg = error.response?.data?.message || 'Something went wrong';
                        showToast(errMsg, 'error');
                    }
                });
            </script>
    </body>