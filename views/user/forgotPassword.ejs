<%- include('../partials/header') %>
    <link rel="stylesheet" href="/css/user/forgotPassword.css">


    <body>

        <header class="main-header">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <img src="https://img.icons8.com/ios-filled/50/ffffff/laptop.png" alt="LapStore Logo Icon"
                        width="18">
                </div>
                <span class="logo-name">LapStore</span>
            </a>

            <nav class="main-nav">
                <a href="#">Home</a>
                <a href="#">Brands</a>
                <a href="#">About Us</a>
                <a href="#">Contact</a>
            </nav>

            <div class="header-icons">
                <a href="#"><i class='bx bx-search'></i></a>
                <a href="#"><i class='bx bx-user'></i></a>
                <a href="#"><i class='bx bx-cart'></i></a>
            </div>
        </header>

        <main class="main-content">
            <div class="forgot-password-container">
                <h1>Forgot Password?</h1>
                <p>Enter your registered email to receive an OTP.</p>

                <form id="forgotForm">
                    <input type="text" placeholder="Email" name="email" class="email" id="email" required>
                    <button type="submit" class="btn-primary otp-btn">Send OTP</button>
                </form>
            </div>
        </main>




        <%- include('../partials/footer') %>

            <script src="/js/axios.min.js"></script>


            <script>
                const forgotForm = document.getElementById('forgotForm');

                const showToast = (message, type) => {
                    const bgColor = type === 'success' ? "linear-gradient(to right, #30E527, #238500)" : "linear-gradient(to right, #e52d27, #b31217)";
                    Toastify({
                        text: message,
                        duration: 3000,
                        gravity: "top",
                        position: "right",
                        style: { background: bgColor, borderRadius: '10px' }
                    }).showToast();
                }

                forgotForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    // 4. Get the email value
                    const email = document.getElementById('email').value;
                    const btn = document.querySelector('.otp-btn')

                    Loading.showButton(btn);

                    if (!email) {
                        Loading.hideButton(btn)
                        showToast("Please enter your email", "error");
                        return;
                    }

                    try {
                        // 5. Send POST request
                        const response = await axios.post('/user/forgot-password', {
                            email: email
                        });

                        if (response.data.success) {
                            showToast(response.data.message, 'success');

                            // 6. Redirect to OTP page after success
                            setTimeout(() => {
                                window.location.href = '/user/verify-otp';
                            }, 1500);
                        } else {
                            Loading.hideButton(btn)
                            showToast(response.data.message || 'Failed to send OTP', 'error');
                        }

                    } catch (error) {
                        Loading.hideButton(btn)
                        console.error(error);
                        const errMsg = error.response?.data?.message || 'Something went wrong';
                        showToast(errMsg, 'error');
                    }
                });
            </script>
    </body>