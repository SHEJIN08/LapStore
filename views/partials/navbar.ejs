<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<link rel="stylesheet" href="/css/user/navbar.css">

<header class="main-header">
    <div class="container header-wrapper">
        <a href="/" class="logo">
            <i class='bx bx-laptop'></i> LapStore
        </a>

        <form action="/user/home/shop" method="GET" class="search-bar" onsubmit="handleSearch(event)"
            style="position: relative; display: flex; align-items: center;">

            <input type="text" name="search" id="searchInput" placeholder="Search for laptops..."
                value="<%= typeof search !== 'undefined' ? search : '' %>" style="padding-right: 35px;"
                oninput="toggleResetButton()">

            <i class='bx bx-x reset-search' id="resetSearchBtn" onclick="clearSearch(event)" title="Clear Search"
                style="display: none;"></i>

            <button type="submit"><i class='bx bx-search'></i></button>
        </form>

        <nav class="user-nav">
            <% if (typeof user !=='undefined' && user) { %>
                <a href="/user/wishlist" class="nav-icon">
                    <i class='bx bx-heart'></i>
                    <span class="tooltip">Wish</span>
                </a>
                <a href="/user/home/cart" class="nav-icon">
                    <i class='bx bx-cart'></i>
                    <span class="tooltip">Cart</span>
                </a>
                <a href="/user/home/profile" class="nav-icon">
                    <i class='bx bx-user'></i>
                    <span class="tooltip">Profile</span>
                </a>

                <a href="/user/logout" class="nav-icon" style="color: #dc3545;"> <i class='bx bx-log-out'></i>
                    <span class="tooltip">Logout</span>
                </a>

                <% } else { %>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <a href="/user/login" style="text-decoration: none; color: #333; font-weight: 500;">Log
                            In</a>
                        <a href="/user/register"
                            style="text-decoration: none; background-color: #333; color: #fff; padding: 8px 20px; border-radius: 20px; font-weight: 500; transition: 0.3s;">Sign
                            Up</a>
                    </div>
                    <a href="/user/home/cart" class="nav-icon" style="margin-bottom: -17px;">
                        <i class='bx bx-cart'></i>
                        <span class="tooltip"></span>
                    </a>
                    <% } %>
        </nav>
    </div>
</header>
<script>

    document.addEventListener('DOMContentLoaded', function () {
        toggleResetButton();
    });

    // 2. Helper to Show/Hide Button based on Input value
    function toggleResetButton() {
        const input = document.getElementById('searchInput');
        const resetBtn = document.getElementById('resetSearchBtn');

        if (input.value.trim().length > 0) {
            resetBtn.style.display = 'block';
        } else {
            resetBtn.style.display = 'none';
        }
    }

    // 3. Handle Search Submission
    function handleSearch(e) {
        const isShopPage = window.location.pathname.includes('/user/home/shop');
        const input = document.getElementById('searchInput');

        // Force show the X button since we are searching
        toggleResetButton();

        if (isShopPage && typeof updateParams === 'function') {
            e.preventDefault();
            updateParams('search', input.value);
        }
        // If not shop page, standard form submit happens
    }

    // 4. Handle Clear Logic
    function clearSearch(e) {
        e.preventDefault();

        const input = document.getElementById('searchInput');
        input.value = ''; // Clear text
        toggleResetButton(); // Hide X button immediately

        const isShopPage = window.location.pathname.includes('/user/home/shop');

        if (isShopPage && typeof updateParams === 'function') {
            // AJAX Clear for Shop Page
            updateParams('search', '');
        } else {
            // Redirect Clear for other pages
            window.location.href = '/user/home/shop';
        }
    }
</script>